<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr">

<head profile="http://gmpg.org/xfn/11">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<title>Emulator Development   &raquo; Sega Master System</title>

<link rel="stylesheet" href="wp-content/themes/default/style.css" type="text/css" media="screen" />
<link rel="alternate" type="application/rss+xml" title="Emulator Development RSS Feed" href="indexd784.html?feed=rss2" />
<link rel="pingback" href="xmlrpc.html" />

<style type="text/css" media="screen">

	#page { background: url("wp-content/themes/default/images/kubrickbgwide.jpg") repeat-y top; border: none; }

</style>

<link rel="EditURI" type="application/rsd+xml" title="RSD" href="xmlrpc0db0.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="wp-includes/wlwmanifest.xml" /> 
<meta name="generator" content="WordPress 2.5.1" />

</head>
<body>
<div id="page">


<div id="header">
	<div id="headerimg">
		<h1><a href="index.html">Emulator Development</a></h1>
		<div class="description">The art of emulator programming</div>
	</div>
</div>
<hr />

	<div id="content" class="narrowcolumn">

		
 	   	  		<h2 class="pagetitle">Archive for the &#8216;Sega Master System&#8217; Category</h2>
 	  

		<div class="navigation">
			<div class="alignleft"><a href="index6bbf.html?cat=4&amp;paged=2">&laquo; Older Entries</a></div>
			<div class="alignright"></div>
		</div>

				<div class="post">
				<h3 id="post-26"><a href="index88b9.html?p=26" rel="bookmark" title="Permanent Link to SMS tutorials complete">SMS tutorials complete</a></h3>
				<small>Tuesday, March 17th, 2009</small>

				<div class="entry">
					<p>Well it has taken me a ridiculous amount of time to pull my finger out and complete the SMS tutorials, but I have finally finished. You can view these tutorials <a href="../../../../www.codeslinger.co.uk/pages/projects/mastersystem.html">here</a></p>
<p>I feel more motivated lately to continue wih my emulation work after a few months break. I&#8217;ll more than likely optimize my gameboy emulator and add sound to it next.</p>
<p>CS</p>
				</div>

				<p class="postmetadata"> Posted in <a href="indexaa1e.html?cat=4" title="View all posts in Sega Master System" rel="category">Sega Master System</a> |   <a href="index88b9.html?p=26#comments" title="Comment on SMS tutorials complete">1 Comment &#187;</a></p>

			</div>

				<div class="post">
				<h3 id="post-24"><a href="index2cf9.html?p=24" rel="bookmark" title="Permanent Link to SMS Emu completion">SMS Emu completion</a></h3>
				<small>Thursday, December 18th, 2008</small>

				<div class="entry">
					<p>I am ready to release the first version of my sega master system emulator. It has approximately 95% compatibility which is enough for me to start writing the SMS tutorials and upload them to the main site. Hopefully I should have them written by the end of the week and I can go back to my Gameboy emulator and implement sound.</p>
<p>The SMS has been a really fun project and I&#8217;ve learnt a lot more about emulation programming from it, but have also realised how much left there is to learn. Hopefully my next emulator (Sega Mega Drive/Genesis) will have more advance emulation techniques.</p>
<p>Keep watching this space for the release of my emulator along with source code and the &#8220;how-to&#8221; tutorials.</p>
<p>CS</p>
				</div>

				<p class="postmetadata"> Posted in <a href="indexaa1e.html?cat=4" title="View all posts in Sega Master System" rel="category">Sega Master System</a> |   <a href="index2cf9.html?p=24#respond" title="Comment on SMS Emu completion">No Comments &#187;</a></p>

			</div>

				<div class="post">
				<h3 id="post-23"><a href="index40a0.html?p=23" rel="bookmark" title="Permanent Link to Sound Emulation">Sound Emulation</a></h3>
				<small>Tuesday, December 16th, 2008</small>

				<div class="entry">
					<p>I&#8217;ve been searching the internet recently trying to find some good documentation on sound emulation. None exist. Hopefully when I finish my emulator and write my &#8220;how to emulate the sega master system&#8221; tutorial on my site, the section on sound emulation should be a good resource to new programmers.</p>
<p>I have found a good article on the SMS sound chip SN79489 written by Maxim which explains how it works, and I have been programming in the dark trying to implement this into my emu. I believe my sound emulator is now 100% complete with the tiny problem that it doesnt seem to be synchronised with the cpu so the frequency of the music is incorrect. Apart from this it seems to be working fine.</p>
<p>Now im on my christmas holidays I should have enough time to get my SMS emulator finished by the end of the week which will be a great achievement. As soon as it&#8217;s finished I&#8217;ll write the tutorials for it and then go back to my gameboy emulator to tweak it and emulate sound before moving on to the sega mega drive, which im really looking forward to.</p>
<p>Merry Christmas all</p>
<p>CS.</p>
				</div>

				<p class="postmetadata"> Posted in <a href="indexaa1e.html?cat=4" title="View all posts in Sega Master System" rel="category">Sega Master System</a> |   <a href="index40a0.html?p=23#respond" title="Comment on Sound Emulation">No Comments &#187;</a></p>

			</div>

				<div class="post">
				<h3 id="post-21"><a href="index3965.html?p=21" rel="bookmark" title="Permanent Link to Debugging an emulator is a pain">Debugging an emulator is a pain</a></h3>
				<small>Monday, November 10th, 2008</small>

				<div class="entry">
					<p>Well this week I&#8217;ve entered a world of pain with my emulator debugger. First of all I had to debug street fighter to see why it wasnt working and it turned out that it was relying on the reading of the mapper control registers (0xFFFC-0xFFFF) to return the values of the mapped address of 0xDFFC-0xDFFF. As soon as I put this into the game I had immediate success.</p>
<p>I finally managed to get mode 2 sprite emulation working which was down to a really stupid error on my part.</p>
<p>Finally I&#8217;ve been debugging why my code masters larger res screen doesnt work and why the graphics are screwy in mortal kombat.</p>
<p>Luckily for me they were both the same error. The error was with my 8 and 16 bit opcodes for adc and sbc. Now this is how I emulated 8 bit adc (for when adding register c to register a):</p>
<blockquote><p><em>BYTE before = m_RegisterAF.hi ;<br />
BYTE toAdd = m_RegisterBC.lo ;</em></p>
<p><em>if (isCarrySet)<br />
toAdd++ ;</em></p>
<p><em>m_RegisterAF.hi += toAdd ;</em></p>
<p><em>if ((before + toAdd) &gt; 0xFF)<br />
SetCarryFlag() ;<br />
else<br />
ResetCarryFlag() ;</em></p>
<p><em>// code to work out the other flags </em></p></blockquote>
<p>Can you spot whats wrong with the above code?</p>
<p>Solution:<br />
At first glance this looks fine however think what would happen if register C was 0xFF? When the carry gets added the toAdd variable wraps back round to 0. So register a stays set to 0xFF which is correct, however the setting of the c flag never gets set. This was causing the following instruction in mortal kombat (jump if carry is set) to fail.</p>
<p>That took me ages to find!</p>
<p>However both mortal kombat and micro machines are playable. My main concern now is why half of the games I play suffer from graphic flicker&#8230;. Better get my debugger back out.</p>
<p>Fortunately this is the last of the big bugs that need debugging and then it&#8217;s on to sound emulation (oh joy). However the end feels just round the corner.</p>
<p>CS</p>
				</div>

				<p class="postmetadata"> Posted in <a href="indexaa1e.html?cat=4" title="View all posts in Sega Master System" rel="category">Sega Master System</a> |   <a href="index3965.html?p=21#respond" title="Comment on Debugging an emulator is a pain">No Comments &#187;</a></p>

			</div>

				<div class="post">
				<h3 id="post-20"><a href="index341b.html?p=20" rel="bookmark" title="Permanent Link to Testing does not prove the absence of bugs, only the presence">Testing does not prove the absence of bugs, only the presence</a></h3>
				<small>Sunday, November 2nd, 2008</small>

				<div class="entry">
					<p>If any of you are writing a Z80 emulator then take it from me dont rely on zexall too much. If zexalls output says you have a bug then you most definately do. However if it says that the test went ok it doesnt mean that they are bug free.</p>
<p>I managed to fix a bug in my emulator without zexalls help which was causing a few games to display the background incorrectly. Mainly Lemmings and Land of Illusion. This bug has been haunting me for awhile so im quite relieved to have fixed it.</p>
<p>I have recently found out that some games run at the wrong speed with my emulator so after checking all my opcodes to see if they are emulating their cycles correctly I was left with the conclusion it must be an error with my vsync emultion. Sure enough I wasnt moving on to the next scanline quick enough which was causing too few vsync interrupts to occur which is one of the main way speed is controlled in games. This is now fixed (after a day of headache) and all games play at the correct speed ( or should I say all tested games? <img src='wp-includes/images/smilies/icon_smile.gif' alt=':)' class='wp-smiley' /> )</p>
<p>Over the past few days I have also emulated the none maskable reset interrupt, the different screen resolution controlled by the current vdp mode and the codemasters mapper. Although the codemasters mapper is implemented correctly the majority of the games show issues with background rendering. However I believe this to be a problem with the background rendering routine rather than the mapper iteself because there is not much room for error with the mapper (compared to the sega mapper anyway).</p>
<p><img src="../../../../www.codeslinger.co.uk/pages/projects/mastersystem/images/lemmings.png" alt="" /></p>
<p>CS</p>
				</div>

				<p class="postmetadata"> Posted in <a href="indexaa1e.html?cat=4" title="View all posts in Sega Master System" rel="category">Sega Master System</a> |   <a href="index341b.html?p=20#respond" title="Comment on Testing does not prove the absence of bugs, only the presence">No Comments &#187;</a></p>

			</div>

				<div class="post">
				<h3 id="post-19"><a href="index5831.html?p=19" rel="bookmark" title="Permanent Link to Checklist">Checklist</a></h3>
				<small>Wednesday, October 29th, 2008</small>

				<div class="entry">
					<p>I&#8217;m starting to come to the end of my master system emulator and thought it best to make a list of what needs  doing before I start writing the tutorials.</p>
<p><strong>Easy:</strong></p>
<ul>
<li><span style="color: #000000;">All control pad buttons including player 2 (<strong>Implemented</strong>)<br />
</span></li>
<li><span style="color: #000000;">Correct Game Speed (<strong>Fixed</strong>)</span></li>
<li><span style="color: #000000;">Reset Interrupt (<strong>Fixed</strong>)</span></li>
<li><span style="color: #000000;">CodeMasters Mapper (<strong>Fixed</strong>)</span></li>
</ul>
<p><strong>Medium:</strong></p>
<ul>
<li><span style="color: #000000;">Zexall test completion (<strong>Fixed</strong>)<br />
</span></li>
<li><span style="color: #000000;">Speed optimizations (<strong>Implemented</strong>)<br />
</span></li>
<li><span style="color: #000000;">Render background correctly for larger screen res (<strong>Fixed</strong>)<br />
</span></li>
<li><span style="color: #000000;">Render mode 2 sprites correctly (<strong>Fixed</strong>)<br />
</span></li>
<li><span style="color: #000000;">Change screen res for codemaster games (<strong>Fixed</strong>)</span></li>
</ul>
<p><strong>Difficult:</strong></p>
<ul>
<li><span style="color: #000000;">Sound (<strong>Implemented</strong>)<br />
</span></li>
<li><span style="color: #000000;">Fix graphical bugs found in Land of Illusion, Lemmings (<strong>Fixed</strong>)</span></li>
<li><span style="color: #000000;">Fix bug Street Fighter (<strong>Fixed</strong>)</span></li>
<li><span style="color: #000000;">Find out why some roms dont show first screen (<strong>Fixed</strong>)</span></li>
<li><span style="color: #000000;">Fix bug in mortal kombat (<strong>Fixed</strong>)</span></li>
<li><span style="color: #000000;">Fix black graphic flicker in some games (<strong>Fixed</strong>)<br />
</span></li>
</ul>
<p>Whenever I fix one of these items I&#8217;ll edit this post and label them as fixed.</p>
<p>Doesn&#8217;t look too bad does it? <img src='wp-includes/images/smilies/icon_smile.gif' alt=':-)' class='wp-smiley' /> </p>
<p>CS</p>
				</div>

				<p class="postmetadata"> Posted in <a href="indexaa1e.html?cat=4" title="View all posts in Sega Master System" rel="category">Sega Master System</a> |   <a href="index5831.html?p=19#respond" title="Comment on Checklist">No Comments &#187;</a></p>

			</div>

				<div class="post">
				<h3 id="post-18"><a href="index0735.html?p=18" rel="bookmark" title="Permanent Link to Not such huge progress">Not such huge progress</a></h3>
				<small>Wednesday, October 29th, 2008</small>

				<div class="entry">
					<p>Well it has been awhile since I&#8217;ve actually done any work on my master system emulator. Mainly because I have bought a PS3 and havent been able to stop playing it. Anyway I&#8217;ve now implemented VDP mode 2 background and sprite rendering. The background rendering seems flawless but the sprite rendering is buggy. I&#8217;ve looked over my code hundreds of times and cant find whats actually wrong with it. Im starting to think that I&#8217;ve implemented mode 2 sprite emulation perfect but there is a bug else where in my code which is causing it to misbehave because the buggy sprites look similar to the buggy sprites in lemmings and Land of Illusion which uses mode 4 rendering. Only time will tell I guess.</p>
<p>I think I have finished emulating the VDP as although I have still yet to implement all the other modes besides 4 and 2, no commercial master system games use the other mode. Infact it is only F16 that uses mode 2 where as all the others use mode 4. Here are some screenshots of F16 using mode 2 rendering.</p>
<p><img src="../../../../www.codeslinger.co.uk/pages/projects/mastersystem/images/f16-1.png"></img><br />
<img src="../../../../www.codeslinger.co.uk/pages/projects/mastersystem/images/f16-2.png"></img></p>
<p>I have also fixed the whacky colours on the &#8220;Wanted&#8221; game. This was due to not implementing RAM mirroring correctly.</p>
<p>CS</p>
				</div>

				<p class="postmetadata"> Posted in <a href="indexaa1e.html?cat=4" title="View all posts in Sega Master System" rel="category">Sega Master System</a> |   <a href="index0735.html?p=18#respond" title="Comment on Not such huge progress">No Comments &#187;</a></p>

			</div>

				<div class="post">
				<h3 id="post-17"><a href="indexd8eb.html?p=17" rel="bookmark" title="Permanent Link to Huge Progress">Huge Progress</a></h3>
				<small>Wednesday, October 1st, 2008</small>

				<div class="entry">
					<p>I have fixed most of the bugs in my CPU emulator and now a lot of games are playable and the majority of them are completeable, which is great news. The only game I know of which is not playable which should be is Lemmings. I have no idea what is happening to this game when I try to emulate it but all the graphics are broke. The only other games that dont work are the ones that use the none standard vdp modes, which is because I&#8217;ve yet to implement them.</p>
<p>Currently my CPU emulator passes 69 of the 70 zexall tests but to be honest I really dont trust zexall that much anymore as I think broken opcodes can still get the thumbs up from zexall. Plus it doesnt check all the instruction like Calls, Jumps, Returns and Exchanges. Still it will be nice when all 70 of the zexall tests are passed by my emulator.</p>
<p>Hopefully by the end of this week my emulator will have passed all 70 of the zexall tests as well as having Lemmings workings. I will also try to implement other parts of the emulator which I&#8217;ve left out, like player twos control pad and the reset interupt. When all this is done I will start working on emulating the remaining VDP modes (which I really dont want to do) along with Sound and then finally speed optimizations. So far my emulator is running dog slow, which isnt suprising considering I have not done any optimizations yet. The reason for this is I like leaving optimizations til last and then I can see just how much of a speed improvement each optimization gives.</p>
<p>CS</p>
				</div>

				<p class="postmetadata"> Posted in <a href="indexaa1e.html?cat=4" title="View all posts in Sega Master System" rel="category">Sega Master System</a> |   <a href="indexd8eb.html?p=17#comments" title="Comment on Huge Progress">2 Comments &#187;</a></p>

			</div>

				<div class="post">
				<h3 id="post-16"><a href="index0e62-2.html?p=16" rel="bookmark" title="Permanent Link to Progress">Progress</a></h3>
				<small>Saturday, September 20th, 2008</small>

				<div class="entry">
					<p>I&#8217;ve had a lot less time available lately to work on my emulator which is why im progressing slower than I thought I would. However I have recently completely fixed scrolling as well as adding tile priorities and the backdrop colour. Zexall complains that there are many bugs in my z80 (all flag related).</p>
<p>The good news is I&#8217;ve added input emulation which is much simpler than it is on the gameboy. Now sonic is completely playable. I&#8217;ve played up to the third level without anything going wrong which is great. Hopefully I&#8217;ll have time to play it fully to see how far I get. Hopefully the game is completeable.</p>
<p>Im having luck with a lot of other games too like Alex Kidd which is also playable. Some games like Woody Pop doesnt even show the first screen which I find worrying because I have no idea whats going wrong. If I had to have a stab in the dark I&#8217;d guess that its related to VDP modes which im not handling yet.</p>
<p>Anyway the rest of the day I&#8217;ll try and make zexall happier with my z80 emulation and maybe look into whats envolved with these vdp modes.</p>
<p>CS</p>
				</div>

				<p class="postmetadata"> Posted in <a href="indexaa1e.html?cat=4" title="View all posts in Sega Master System" rel="category">Sega Master System</a> |   <a href="index0e62-2.html?p=16#respond" title="Comment on Progress">No Comments &#187;</a></p>

			</div>

				<div class="post">
				<h3 id="post-15"><a href="indexa1ca.html?p=15" rel="bookmark" title="Permanent Link to Instruction set update">Instruction set update</a></h3>
				<small>Monday, September 15th, 2008</small>

				<div class="entry">
					<p>Hi Guys,</p>
<p>I have managed to get all of the standard opcodes implemented along with all CB, ED, DDCB and FDCB prefixes. I have a lot of the DD and FD opcodes left to implement though.</p>
<p>I have improved the scrolling of the background but still got some graphical glitches to iron out.</p>
<p>The good news is that I have had massive improvement in the amount of games showing their first screen (mainly because I&#8217;ve implemented the ED and DDCB opcodes). Hopefully when I finish the DD and FD opcodes I should be able to play in game.</p>
<p>Here are some screenshots of how it&#8217;s looking at the moment. You can see the graphical glitches on Alex Kidd as he has a black box surrounding him. This is either priority or transparency that im not implementing correctly.</p>
<p><img src="../../../../www.codeslinger.co.uk/pages/projects/mastersystem/images/sonic.png" alt="Sonic" /><br />
<img src="../../../../www.codeslinger.co.uk/pages/projects/mastersystem/images/phantasy.png" alt="Phantasy Star" /></p>
<p><img src="../../../../www.codeslinger.co.uk/pages/projects/mastersystem/images/alex.png" alt="Alex Kidd" /></p>
<p><img src="../../../../www.codeslinger.co.uk/pages/projects/mastersystem/images/ecco.png" alt="Ecco the Dolphin" /></p>
<p><img src="../../../../www.codeslinger.co.uk/pages/projects/mastersystem/images/columns.png" alt="Columns" /></p>
				</div>

				<p class="postmetadata"> Posted in <a href="indexaa1e.html?cat=4" title="View all posts in Sega Master System" rel="category">Sega Master System</a> |   <a href="indexa1ca.html?p=15#respond" title="Comment on Instruction set update">No Comments &#187;</a></p>

			</div>

		
		<div class="navigation">
			<div class="alignleft"><a href="index6bbf.html?cat=4&amp;paged=2">&laquo; Older Entries</a></div>
			<div class="alignright"></div>
		</div>

	
	</div>

	<div id="sidebar">
		<ul>
						<li>
				<form method="get" id="searchform" action="http://codeslinger.co.uk/pages/blog/wordpress/">
<div><input type="text" value="" name="s" id="s" />
<input type="submit" id="searchsubmit" value="Search" />
</div>
</form>
			</li>

			<!-- Author information is disabled per default. Uncomment and fill in your details if you want to use it.
			<li><h2>Author</h2>
			<p>A little something about you, the author. Nothing lengthy, just an overview.</p>
			</li>
			-->

			 <li>

						<p>You are currently browsing the archives for the Sega Master System category.</p>

			
			</li> 
			
			<li><h2>Archives</h2>
				<ul>
					<li><a href='indexd189.html?m=201005' title='May 2010'>May 2010</a></li>
	<li><a href='indexc36d.html?m=200905' title='May 2009'>May 2009</a></li>
	<li><a href='index17e8.html?m=200904' title='April 2009'>April 2009</a></li>
	<li><a href='index10a5.html?m=200903' title='March 2009'>March 2009</a></li>
	<li><a href='index8988.html?m=200902' title='February 2009'>February 2009</a></li>
	<li><a href='index7866.html?m=200812' title='December 2008'>December 2008</a></li>
	<li><a href='index55f6.html?m=200811' title='November 2008'>November 2008</a></li>
	<li><a href='indexa7bc.html?m=200810' title='October 2008'>October 2008</a></li>
	<li><a href='indexe77c.html?m=200809' title='September 2008'>September 2008</a></li>
	<li><a href='indexcffc.html?m=200808' title='August 2008'>August 2008</a></li>
	<li><a href='index0e62.html?m=200807' title='July 2008'>July 2008</a></li>
				</ul>
			</li>

			<li class="categories"><h2>Categories</h2><ul>	<li class="cat-item cat-item-3"><a href="index81ea.html?cat=3" title="View all posts filed under Gameboy">Gameboy</a> (6)
</li>
	<li class="cat-item cat-item-4 current-cat"><a href="indexaa1e.html?cat=4" title="View all posts filed under Sega Master System">Sega Master System</a> (13)
</li>
	<li class="cat-item cat-item-1"><a href="indexb31a.html?cat=1" title="View all posts filed under Uncategorized">Uncategorized</a> (4)
</li>
	<li class="cat-item cat-item-5"><a href="indexb946.html?cat=5" title="View all posts filed under Zuko">Zuko</a> (1)
</li>
</ul></li>
			
					</ul>
	</div>



<hr />
<div id="footer">
<!-- If you'd like to support WordPress, having the "powered by" link somewhere on your blog is the best way; it's our only promotion or advertising. -->
	<p>
		Emulator Development is proudly powered by
		<a href="http://wordpress.org/">WordPress</a>
		<br /><a href="indexd784.html?feed=rss2">Entries (RSS)</a>
		and <a href="indexa6da.html?feed=comments-rss2">Comments (RSS)</a>.
		<!-- 20 queries. 0.219 seconds. -->
	</p>
</div>
</div>

<!-- Gorgeous design by Michael Heilemann - http://binarybonsai.com/kubrick/ -->

		</body>

<!-- Mirrored from codeslinger.co.uk/pages/blog/wordpress/?cat=4 by HTTrack Website Copier/3.x [XR&CO'2010], Thu, 11 Aug 2011 17:34:38 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8"><!-- /Added by HTTrack -->
</html>
